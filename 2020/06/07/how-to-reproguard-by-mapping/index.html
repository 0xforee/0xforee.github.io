<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="baidu-site-verification" content="codeva-4pzb7QQt07"><title>如何通过 Mapping 文件反混淆 - 0xforee&#039;s blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="0xforee&#039;s blog"><meta name="msapplication-TileImage" content="/img/bbb.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="0xforee&#039;s blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="做过 Android 开发的应该或多或少都知道“混淆”这个技术点，它不仅可以帮助我们增加三方逆向的难度，还可以有效减少包体积，瘦身 APK"><meta property="og:type" content="blog"><meta property="og:title" content="如何通过 Mapping 文件反混淆"><meta property="og:url" content="http://www.0xforee.top/2020/06/07/how-to-reproguard-by-mapping/"><meta property="og:site_name" content="0xforee&#039;s blog"><meta property="og:description" content="做过 Android 开发的应该或多或少都知道“混淆”这个技术点，它不仅可以帮助我们增加三方逆向的难度，还可以有效减少包体积，瘦身 APK"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://www.0xforee.top/2020/06/07/how-to-reproguard-by-mapping/ProGuard_ReTrace.png"><meta property="article:published_time" content="2020-06-07T15:57:00.000Z"><meta property="article:modified_time" content="2023-08-12T10:13:21.469Z"><meta property="article:author" content="0xforee"><meta property="article:tag" content="android"><meta property="article:tag" content="compile"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://www.0xforee.top/2020/06/07/how-to-reproguard-by-mapping/ProGuard_ReTrace.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://www.0xforee.top/2020/06/07/how-to-reproguard-by-mapping/"},"headline":"如何通过 Mapping 文件反混淆","image":["http://www.0xforee.top/2020/06/07/how-to-reproguard-by-mapping/ProGuard_ReTrace.png"],"datePublished":"2020-06-07T15:57:00.000Z","dateModified":"2023-08-12T10:13:21.469Z","author":{"@type":"Person","name":"0xforee"},"publisher":{"@type":"Organization","name":"0xforee's blog","logo":{"@type":"ImageObject","url":"http://www.0xforee.top/img/bbb.png"}},"description":"做过 Android 开发的应该或多或少都知道“混淆”这个技术点，它不仅可以帮助我们增加三方逆向的难度，还可以有效减少包体积，瘦身 APK"}</script><link rel="canonical" href="http://www.0xforee.top/2020/06/07/how-to-reproguard-by-mapping/"><link rel="icon" href="/img/bbb.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?8e6bb145a6bd99001a8efd90754c2fb0";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-W64LLZYFJX" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-W64LLZYFJX');</script><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="0xforee's blog" type="application/atom+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/bbb.png" alt="0xforee&#039;s blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">时间轴</a><a class="navbar-item" href="/categories">栏目</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-9-tablet is-9-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><h1 class="title is-3 is-size-4-mobile">如何通过 Mapping 文件反混淆</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-06-07T15:57:00.000Z" title="6/7/2020, 11:57:00 PM">2020-06-07</time></span><span class="level-item"><a class="link-muted" href="/categories/Android/">Android</a></span><span class="level-item">23 分钟读完 (大约3522个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><div class="content"><h1 id="写在前边"><a href="#写在前边" class="headerlink" title="写在前边"></a>写在前边</h1><p>做过 Android 开发的应该或多或少都知道“混淆”这个技术点，它不仅可以帮助我们增加三方逆向的难度，还可以有效减少包体积，瘦身 APK</p>
<p>其实这些能力都来自于 Proguard 这个程序，Proguard 能利用字典文件，在编译时将我们的类名，方法名，字段名都替换掉，最后生成一份非常反人类的编译产物。Proguard 在每次运行时都会创建一个 mapping.txt 文件，其中列出了经过混淆处理的类、方法和字段名称与原始名称的映射关系。此映射文件还包含用于将行号映射回原始源文件行号的信息</p>
<p>这篇文章的目的就是要解析生成的 Mapping 文件</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="Mapping-文件的来源与用途"><a href="#Mapping-文件的来源与用途" class="headerlink" title="Mapping 文件的来源与用途"></a>Mapping 文件的来源与用途</h2><p>以下就是 Mapping 文件的生成过程</p>
<img src="./ProGuard_ReTrace.png" width="40%" height="40%">


<p>这个 Mapping 文件是由 Proguard 程序自动生成的，会存放在 output 目录下，与 release 包放在一起。需要谨记的是，Mapping 文件可能在每次 Proguard 运行后都会不同，所以发布给用户的包一定要留存好 Mapping 文件，方便后续跟踪解决问题</p>
<h2 id="了解-Mapping-文件的好处"><a href="#了解-Mapping-文件的好处" class="headerlink" title="了解 Mapping 文件的好处"></a>了解 Mapping 文件的好处</h2><p>了解 Mapping 文件最直观的好处在于我们跟踪线上的经过混淆之后的 Crash 信息时，可以从 Mapping 文件逆向推出原始的堆栈信息，更快更方便的定位问题，但不只这些，我们还可以通过 Mapping 文件处理内存快照文件 Hprof 的反混淆，处理 Systrace 的文件的反混淆，还有 Nanoscope 文件的反混淆等</p>
<h2 id="如何解析-Mapping-文件"><a href="#如何解析-Mapping-文件" class="headerlink" title="如何解析 Mapping 文件"></a>如何解析 Mapping 文件</h2><blockquote>
<p>注意：Android 在新版中启用了 R8 编译器，没有使用 Proguard 工具，虽然兼容 Proguard 的配置和字典等，但是编译出来的 Mapping 文件格式还是有一点不同。我们会在最后一个小节讲一下其中的不同</p>
</blockquote>
<p>下面我们详细来看 Mapping 文件的格式</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">classline</span></span><br><span class="line">    fieldline *</span><br><span class="line">    methodline *</span><br></pre></td></tr></table></figure>

<p>Mapping 文件的正式部分由多个 Class 块组成，每个 Class 块中包含混淆前后的类信息，字段信息，方法信息。每个 Class 块由顶格的类信息开头，后边跟着开头带有4个空格的字段信息与方法信息<br>每个 Class 块中详细格式如下： </p>
<p><strong>类信息：</strong></p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">originalclassname</span> -&gt;</span> obfuscatedclassname:</span><br></pre></td></tr></table></figure>

<p>混淆之前的全限定类名与混淆后的全限定类名通过 <code>-&gt;</code> 分隔符分割，以 <code>:</code> 标识当前类信息的结束，标识类内字段，方法信息的开始</p>
<blockquote>
<p>备注：全限定类名，是指带有包名限定的类名，可以完全定位一个类</p>
</blockquote>
<p><strong>字段信息：</strong></p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">originalfieldtype </span><span class="keyword">originalfieldname </span>-&gt; obfuscatedfieldname</span><br></pre></td></tr></table></figure>

<p>混淆之前的字段信息与混淆之后的字段信息同样通过 <code>-&gt;</code> 分隔符分割，值得注意的是，混淆前的字段包含了字段类型和字段名称，而混淆之后只有字段名称  </p>
<p><strong>方法信息：</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[startline:endline:]</span>originalreturntype <span class="selector-attr">[originalclassname.]</span><span class="built_in">originalmethodname</span>(originalargumenttype,...)<span class="selector-attr">[:originalstartline[:originalendline]</span>] -&gt; obfuscatedmethodname</span><br></pre></td></tr></table></figure>

<blockquote>
<p>备注：标识着 <code>*</code> 的行，意味着可能出现任意多次;<br><code>[]</code> 表示内容是可选的;<br><code>…</code> 表示可能会出现任意多个前边指定的item;<br><code>:</code>与<code>，</code>与<code>-&gt;</code>都是分隔符       </p>
</blockquote>
<p>方法信息同样通过 <code>-&gt;</code> 分隔符分割，但是方法信息比类信息和字段信息更复杂一点，因为方法还额外包含了行号表，参数，返回类型等信息</p>
<ul>
<li>originalreturntype：原始返回类型，全限定类名，或者基本类型，或者无类型 void</li>
<li>originalmethodname：原始方法名称</li>
<li>originalclassname：可选，当方法不属于所在的类块时，需要特别通过全限定类名引用</li>
<li>originalargumenttype：原始参数类型，全限定类名或者基本类型，多个参数按顺序通过 <code>,</code> 分割</li>
<li>obfuscatedmethodname：混淆后的名称</li>
</ul>
<p>剩下的行号信息，稍微复杂一点要根据方法有没有做内联优化分成两种情况：</p>
<h3 id="无内联优化："><a href="#无内联优化：" class="headerlink" title="无内联优化："></a>无内联优化：</h3><ul>
<li>[startline:endline:]：和 Jvm 字节码中的 LineNumberTable 对应，表示原始代码的行号范围</li>
<li>[:originalstartline[:originalendline]]：无内联优化，这个字段不存在</li>
</ul>
<h3 id="有内联优化"><a href="#有内联优化" class="headerlink" title="有内联优化"></a>有内联优化</h3><ul>
<li>[startline:endline:]：是一个编译器给出的一个类似于源码中的行号，为什么说类似于源码行号，我们后边通过示例来说明</li>
<li>[:originalstartline[:originalendline]]：这个字段中 originalendline 又是可选的，所以也分两种情况    <ul>
<li>[:originalstartline]：只有起始行号，表示这是异常的某个中间调用（？？？大问号？后边通过示例来说明吧，这里不好理解)</li>
<li>[:originalstartline:originalendline]：有行号范围，表示在源码中的真实行号范围，对应源码的方法范围</li>
</ul>
</li>
</ul>
<p>有一些要注意的点：</p>
<ol>
<li>方法的行号唯一标识了这个方法，这个在我们从堆栈中反推原始信息时特别有用</li>
<li>如果方法的行号没有存在，那么我们只能通过方法的签名（或者描述符）来反混淆代码，但是这种匹配不是绝对准确的，可能会出现匹配到多个相同的方法或字段</li>
</ol>
<h2 id="Mapping-示例分析"><a href="#Mapping-示例分析" class="headerlink" title="Mapping 示例分析"></a>Mapping 示例分析</h2><h3 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">com example.application.ArgumentWordReader -&gt; com.example.a.a:</span><br><span class="line">    java.lang.String[] arguments -&gt; a</span><br><span class="line">    int index -&gt; a</span><br><span class="line">    36:57:void &lt;init&gt;(java.lang.String[],java.io.File) -&gt; &lt;init&gt;</span><br><span class="line">    64:64:java.lang.String nextLine() -&gt; a</span><br><span class="line">    72:72:java.lang.String lineLocationDescription() -&gt; b</span><br></pre></td></tr></table></figure>

<p>com example.application.ArgumentWordReader 被混淆为 com.example.a.a ，其中字符 a 来源于混淆文件中所配置的字典文件<br>字段 arguments 和 index 会在混淆中丢掉类型信息，同时转换为混淆字符 a</p>
<blockquote>
<p>如果多个方法或者字段的签名（或者说描述符）不同，那么混淆之后的名称可能是相同的</p>
</blockquote>
<p>方法的实例构造函数 <code>&lt;init&gt;</code> 和静态类构造函数 <code>&lt;clinit&gt;</code> ，名称不会被混淆，只会丢弃其参数列表和返回类型</p>
<p>方法 nextLine 和 lineLocationDescription 都有自己的源码行号范围，但是返回类型和参数列表是相同的，如果在混淆的配置文件中配置保留了 LineNumberTable，那么在报错堆栈中就可以看到行号，也就可以通过行号定位到具体的方法，而如果没有在混淆的配置文件中配置保留 LineNumberTable，那么报错堆栈中也就不会打印出行号，仅仅通过返回类型和参数列表是无法区分二者的，所以这就是为什么这两个方法的混淆之后的名称是不同的</p>
<p>以上的示例比较简单，我们来看一下复杂的示例</p>
<h3 id="复杂示例"><a href="#复杂示例" class="headerlink" title="复杂示例"></a>复杂示例</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">com<span class="selector-class">.example</span><span class="selector-class">.application</span><span class="selector-class">.Main</span> -&gt; com<span class="selector-class">.example</span><span class="selector-class">.application</span><span class="selector-class">.Main</span>:</span><br><span class="line">    com<span class="selector-class">.example</span><span class="selector-class">.application</span><span class="selector-class">.Configuration</span> configuration -&gt; <span class="selector-tag">a</span></span><br><span class="line">    <span class="number">50</span>:<span class="number">66</span>:void &lt;init&gt;(com<span class="selector-class">.example</span><span class="selector-class">.application</span>.Configuration) -&gt; &lt;init&gt;</span><br><span class="line">    <span class="number">74</span>:<span class="number">228</span>:void <span class="built_in">execute</span>() -&gt; <span class="selector-tag">a</span></span><br><span class="line">    <span class="number">2039</span>:<span class="number">2056</span>:void com<span class="selector-class">.example</span><span class="selector-class">.application</span><span class="selector-class">.GPL</span><span class="selector-class">.check</span>():<span class="number">39</span>:<span class="number">56</span> -&gt; <span class="selector-tag">a</span></span><br><span class="line">    <span class="number">2039</span>:<span class="number">2056</span>:void <span class="built_in">execute</span>():<span class="number">76</span> -&gt; <span class="selector-tag">a</span></span><br><span class="line">    <span class="number">2236</span>:<span class="number">2252</span>:void <span class="built_in">printConfiguration</span>():<span class="number">236</span>:<span class="number">252</span> -&gt; <span class="selector-tag">a</span></span><br><span class="line">    <span class="number">2236</span>:<span class="number">2252</span>:void <span class="built_in">execute</span>():<span class="number">80</span> -&gt; <span class="selector-tag">a</span></span><br><span class="line">    <span class="number">3040</span>:<span class="number">3042</span>:java<span class="selector-class">.io</span><span class="selector-class">.PrintWriter</span> com<span class="selector-class">.example</span><span class="selector-class">.application</span><span class="selector-class">.util</span><span class="selector-class">.PrintWriterUtil</span><span class="selector-class">.createPrintWriterOut</span>(java<span class="selector-class">.io</span>.File):<span class="number">40</span>:<span class="number">42</span> -&gt; <span class="selector-tag">a</span></span><br><span class="line">    <span class="number">3040</span>:<span class="number">3042</span>:void <span class="built_in">printConfiguration</span>():<span class="number">243</span> -&gt; <span class="selector-tag">a</span></span><br><span class="line">    <span class="number">3040</span>:<span class="number">3042</span>:void <span class="built_in">execute</span>():<span class="number">80</span> -&gt; <span class="selector-tag">a</span></span><br><span class="line">    <span class="number">3260</span>:<span class="number">3268</span>:void <span class="built_in">readInput</span>():<span class="number">260</span>:<span class="number">268</span> -&gt; <span class="selector-tag">a</span></span><br><span class="line">    <span class="number">3260</span>:<span class="number">3268</span>:void <span class="built_in">execute</span>():<span class="number">97</span> -&gt; a</span><br></pre></td></tr></table></figure>
<p>com.example.application.Main 类配置了 keep 属性，所以类信息没有被混淆掉，一般我们会把可能需要被反射使用的类保留，防止在 release 包中类名变化导致混淆使用出错</p>
<p>configuration 字段信息同上，混淆后丢弃类型<br>实例构造函数 <code>&lt;init&gt;</code> 和方法 execute 同上解析方式</p>
<p>剩下的方法都比较奇怪，开头的行号都是特别大的数字，且有几个方法行号是相同的，明显不是正常的行号，<br>这是因为经过了方法内联处理，在混淆处理的过程中，可能会内联方法到其他方法中，甚至进行递归的内联</p>
<h3 id="方法内联"><a href="#方法内联" class="headerlink" title="方法内联"></a>方法内联</h3><p>简单来说，就是将互相调用的多个方法合并为一个方法，这样减少程序方法调用的次数，从而减少程序调用过程中的栈帧的创建销毁等额外的消耗，提升性能<br>例如</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">class</span> <span class="variable">A</span>:</span><br><span class="line">    <span class="variable">def</span> <span class="function"><span class="title">a</span>():</span></span><br><span class="line"><span class="function">        <span class="title">print</span>(<span class="string">&quot;a&quot;</span>)</span></span><br><span class="line">        <span class="variable">B.b</span>()</span><br><span class="line"><span class="variable">class</span> <span class="variable">B</span>:</span><br><span class="line">    <span class="variable">def</span> <span class="function"><span class="title">b</span>():</span></span><br><span class="line"><span class="function">        <span class="title">print</span>(<span class="string">&quot;from B&quot;</span>)</span></span><br><span class="line">        <span class="function"><span class="title">print</span>(<span class="string">&quot;b&quot;</span>)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>做方法内联优化之后：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">A:</span></span><br><span class="line"><span class="symbol">    <span class="symbol">def</span></span> <span class="symbol">a</span>():</span><br><span class="line">        <span class="symbol">print</span>(&quot;<span class="symbol">a</span>&quot;)</span><br><span class="line">        <span class="symbol">print</span>(&quot;<span class="symbol">from</span> <span class="symbol">B</span>&quot;)</span><br><span class="line">        <span class="symbol">print</span>(&quot;<span class="symbol">b</span>&quot;) // <span class="symbol">inner</span> <span class="symbol">line</span> <span class="symbol">from</span> <span class="symbol">B</span>()</span><br></pre></td></tr></table></figure>

<p>了解了方法内联之后，我们再来看方法内联对混淆的影响，方法内联之后，堆栈中原来 B.b() 方法已经被内联到 A.a() 方法中，混淆之后的方法信息也自然指向了 A.a()，那么堆栈中出现的错误信息也是指向 A.a()，但是我们源码中的调用是来自方法 B.b() 的，所以内联前后的优化信息我们是需要知道的，方便在后续堆栈信息追踪时反推源码信息。</p>
<p>下边我们就看一下具体的解析方法</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2039</span>:<span class="number">2056</span>:void com<span class="selector-class">.example</span><span class="selector-class">.application</span><span class="selector-class">.GPL</span><span class="selector-class">.check</span>():<span class="number">39</span>:<span class="number">56</span> -&gt; <span class="selector-tag">a</span></span><br><span class="line"><span class="number">2039</span>:<span class="number">2056</span>:void <span class="built_in">execute</span>():<span class="number">76</span> -&gt; a</span><br></pre></td></tr></table></figure>
<p>方法最前边的行号范围如果相同，就代表一个内联链中的方法调用链，比如以上两句表示，方法 check 被内联到了 execute 方法中，内联的位置是原 execute 方法的第76行，如果末尾是行号范围，那么对应的就是最终的内联方法体</p>
<p>开头的行号是内联函数调用链最底层的行号范围和编译器给予的一定的偏移量加和的结果，偏移量是<br>1000的倍数，偏移量的目的是避免与其他的正常的代码范围产生冲突，所以2039：2056是来自 check 方法的源码行号范围 39:56 与 2000 的偏移量相加得出的结果</p>
<p>另外，因为 check 方法因为不属于类 com.example.application.Main，所以使用了类全限定符标识，标明 check 所处的类</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2236</span>:<span class="number">2252</span>:void <span class="built_in">printConfiguration</span>():<span class="number">236</span>:<span class="number">252</span> -&gt; <span class="selector-tag">a</span></span><br><span class="line"><span class="number">2236</span>:<span class="number">2252</span>:void <span class="built_in">execute</span>():<span class="number">80</span> -&gt; <span class="selector-tag">a</span></span><br><span class="line"><span class="number">3040</span>:<span class="number">3042</span>:java<span class="selector-class">.io</span><span class="selector-class">.PrintWriter</span> com<span class="selector-class">.example</span><span class="selector-class">.application</span><span class="selector-class">.util</span><span class="selector-class">.PrintWriterUtil</span><span class="selector-class">.createPrintWriterOut</span>(java<span class="selector-class">.io</span>.File):<span class="number">40</span>:<span class="number">42</span> -&gt; <span class="selector-tag">a</span></span><br><span class="line"><span class="number">3040</span>:<span class="number">3042</span>:void <span class="built_in">printConfiguration</span>():<span class="number">243</span> -&gt; <span class="selector-tag">a</span></span><br><span class="line"><span class="number">3040</span>:<span class="number">3042</span>:void <span class="built_in">execute</span>():<span class="number">80</span> -&gt; a</span><br></pre></td></tr></table></figure>
<p>以上 Mapping 文件的分析方法和之前的一致，唯一需要说明的是这其中的关联<br>execute 方法在80行内联了方法 printConfiguration，后者的行号范围是 236:252，其中，printConfiguration 又在 243 行内联了方法 createPrintWriterOut，后者的行号范围是 40:42。</p>
<p>至此，我们分析完了 Mapping 文件的所有情况的格式，最后的两行交由读者自己尝试分析一下。</p>
<h2 id="R8-编译器"><a href="#R8-编译器" class="headerlink" title="R8 编译器"></a>R8 编译器</h2><p>当使用 Android Gradle 插件 3.4.0 或更高版本构建项目时，该插件不再使用 ProGuard 来执行编译时代码优化，而是与 R8 编译器协同工作来处理编译时任务，所以可以通过 Gradle 插件版本来查看具体使用了 Proguard 还是 R8 编译器。</p>
<p>R8 编译器一定程度上兼容 Proguard 规则，但是还是略有不同。</p>
<p>详情可以参看官网：<a target="_blank" rel="noopener" href="https://developer.android.com/studio/build/shrink-code?hl=zh-cn">https://developer.android.com/studio/build/shrink-code?hl=zh-cn</a></p>
<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>Mapping 文件以 # 开头的行作为注释，标识 R8 程序的格式，日期等信息，但是在 Proguard 中还未发现这样的规范</p>
<p>例如以下：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># compiler: R8</span><br><span class="line"># compiler_version: <span class="number">1.6</span><span class="number">.82</span></span><br><span class="line"># min_api: <span class="number">19</span></span><br><span class="line"># pg_map_id: <span class="number">6</span>af58cc</span><br><span class="line"># common_typos_disable</span><br></pre></td></tr></table></figure>

<h3 id="与-Proguard-区别"><a href="#与-Proguard-区别" class="headerlink" title="与 Proguard 区别"></a>与 Proguard 区别</h3><p>R8 中的行号的表示方式和 Proguard 还不太一样，以下的解析方式是基于 Proguard 新版的规范和源码相印证的结果，在 R8 的官方文档中，是直接导向 Proguard 官网的，并没有自己的格式的说明（这点在 Hprof 格式也是），所以有谁找到对应的官方文档，可以帮忙附到评论中，感谢。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">androidx</span>.appcompat.app.AppCompatActivity -&gt; androidx.appcompat.app.AppCompatActivity:</span><br><span class="line">    <span class="attribute">1</span>:<span class="number">1</span>:void &lt;init&gt;():<span class="number">77</span>:<span class="number">77</span> -&gt; &lt;init&gt;</span><br><span class="line">    <span class="attribute">2</span>:<span class="number">2</span>:void &lt;init&gt;(int):<span class="number">92</span>:<span class="number">92</span> -&gt; &lt;init&gt;</span><br><span class="line">    <span class="attribute">1</span>:<span class="number">1</span>:void addContentView(android.view.View,android.view.ViewGroup$LayoutParams):<span class="number">176</span>:<span class="number">176</span> -&gt; addContentView</span><br><span class="line">    <span class="attribute">1</span>:<span class="number">2</span>:void attachBaseContext(android.content.Context):<span class="number">97</span>:<span class="number">98</span> -&gt; attachBaseContext</span><br><span class="line">    <span class="attribute">1</span>:<span class="number">4</span>:void closeOptionsMenu():<span class="number">609</span>:<span class="number">612</span> -&gt; closeOptionsMenu</span><br><span class="line">    <span class="attribute">1</span>:<span class="number">2</span>:boolean dispatchKeyEvent(android.view.KeyEvent):<span class="number">552</span>:<span class="number">553</span> -&gt; dispatchKeyEvent</span><br><span class="line">    <span class="attribute">3</span>:<span class="number">3</span>:boolean dispatchKeyEvent(android.view.KeyEvent):<span class="number">555</span>:<span class="number">555</span> -&gt; dispatchKeyEvent</span><br><span class="line">    <span class="attribute">4</span>:<span class="number">4</span>:boolean dispatchKeyEvent(android.view.KeyEvent):<span class="number">558</span>:<span class="number">558</span> -&gt; dispatchKeyEvent</span><br><span class="line">    <span class="attribute">1</span>:<span class="number">1</span>:android.view.View findViewById(int):<span class="number">214</span>:<span class="number">214</span> -&gt; findViewById</span><br></pre></td></tr></table></figure>

<p>这是一个 R8 编译完成的 Mapping 文件示例，因为都使用了 keep 属性，所以没有被混淆之后名称没有被字典中的字符替换掉，但这点对于分析 Mapping 格式没有什么影响。</p>
<p>和 Proguard 规范有所不同的是：</p>
<ol>
<li>许多方法并没有用一个连续的行号范围标识，而是被拆分成了不同的子块，每个子块都有自身对应的行号范围，方法前边的是虚拟行号，对应后边的真实行号范围</li>
</ol>
<p>例如：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>:<span class="number">1</span>:void &lt;init&gt;<span class="literal">()</span>:<span class="number">77</span>:<span class="number">77</span> -&gt; &lt;init&gt;</span><br><span class="line"><span class="number">2</span>:<span class="number">2</span>:void &lt;init&gt;(<span class="built_in">int</span>):<span class="number">92</span>:<span class="number">92</span> -&gt; &lt;init&gt;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>:<span class="number">2</span>:boolean dispatch<span class="constructor">KeyEvent(<span class="params">android</span>.<span class="params">view</span>.KeyEvent)</span>:<span class="number">552</span>:<span class="number">553</span> -&gt; dispatchKeyEvent</span><br><span class="line"><span class="number">3</span>:<span class="number">3</span>:boolean dispatch<span class="constructor">KeyEvent(<span class="params">android</span>.<span class="params">view</span>.KeyEvent)</span>:<span class="number">555</span>:<span class="number">555</span> -&gt; dispatchKeyEvent</span><br><span class="line"><span class="number">4</span>:<span class="number">4</span>:boolean dispatch<span class="constructor">KeyEvent(<span class="params">android</span>.<span class="params">view</span>.KeyEvent)</span>:<span class="number">558</span>:<span class="number">558</span> -&gt; dispatchKeyEvent</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>各个方法的虚拟行号的范围是有所重叠的，但是所对应的混淆之后的名称是不同的，所以在区分不同方法上来说是没有歧义的</li>
</ol>
<p>例如：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>:<span class="number">2</span>:void attachBaseContext(android.content.Context):<span class="number">97</span>:<span class="number">98</span> -&gt; attachBaseContext</span><br><span class="line"><span class="attribute">1</span>:<span class="number">4</span>:void closeOptionsMenu():<span class="number">609</span>:<span class="number">612</span> -&gt; closeOptionsMenu</span><br></pre></td></tr></table></figure>

<p>虚拟行号范围重叠了，但实际的行号范围是不一样的，而且混淆后的名称也是不同的</p>
<ol start="3">
<li>R8 编译出的文件中并未找到内联方法相关的编译优化，不确定是没有开对应的优化项还是说根本就没有这项优化，所以不会出现 Proguard 之前的内联相关的调用栈的 Mapping 信息</li>
</ol>
<h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>基于以上的 Mapping 文件的解析规则，我们可以做很多事情，比如反混淆 Trace 文件，反混淆 Nanoscope 文件，反混淆 Hprof 文件等等，我基于这个规则，开发了一个 ReProguard 的程序，可以供大家参考，欢迎交流提意见</p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/0xforee/ReProguard">https://github.com/0xforee/ReProguard</a></p>
<p>如果后续有时间，我会基于收集的资料写一个 Hprof 文件格式的解析教程，欢迎评论交流。^_^</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>如何通过 Mapping 文件反混淆</p><p><a href="http://www.0xforee.top/2020/06/07/how-to-reproguard-by-mapping/">http://www.0xforee.top/2020/06/07/how-to-reproguard-by-mapping/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>0xforee</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2020-06-07</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2023-08-12</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/android/">android</a><a class="link-muted mr-2" rel="tag" href="/tags/compile/">compile</a></div><div class="article-tags is-size-7 mb-4"> <emoji-reaction availableArrayString="👍,thumbs-up;😄,smile-face;🎉,party-popper;😕,confused-face;❤️,red-heart;🚀,rocket;👀,eyes;"></emoji-reaction> </div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><i class="fas fa-share-nodes fa-2xl" style="float:left;margin-right: 10px;"></i><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a><a class="a2a_button_wechat"></a><a class="a2a_button_telegram"></a><a class="a2a_button_evernote"></a><a class="a2a_button_pocket"></a><a class="a2a_button_flipboard"></a><a class="a2a_button_douban"></a><a class="a2a_button_instapaper"></a><a class="a2a_button_kindle_it"></a><a class="a2a_button_email"></a><a class="a2a_button_copy_link"></a><i class="fa-light fa-share"></i></div><script async src="https://static.addtoany.com/menu/page.js"></script><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/alipay.jpg" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/wechat.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2023/07/02/begging_of_glide_code_design/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">从代码设计看 Glide 之写在开头</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2019/11/11/android-jsbridge/"><span class="level-item">一篇写给 Android 刚入门小伙伴的 JSBridge 文章</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content" id="valine-thread"></div><script src="//cdn.jsdelivr.net/npm/leancloud-storage@3/dist/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.16/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread',
            appId: "syj6F1Y9iqTJ7vzM2sniKUYz-gzGzoHsz",
            appKey: "Ox2jK9gEuEEsz0gyfOiCSf8P",
            placeholder: "gogo",
            avatar: "mm",
            avatarForce: false,
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "zh-CN",
            visitor: false,
            highlight: true,
            recordIP: false,
            
            
            
            enableQQ: false,
            requiredFields: [],
        });</script></div></div></div><!--!--><div class="column column-right is-3-tablet is-3-desktop is-3-widescreen  order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/head.png" alt="0xforee"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">0xforee</p><p class="is-size-6 is-block">Read The Fuck Code</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Earth</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">29</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">栏目</p><a href="/categories"><p class="title">10</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">39</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/0xforee" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/0xforee"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="JueJin" href="https://juejin.cn/user/2518350422615987"><i class="fas fa-j"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="CSDN" href="https://blog.csdn.net/beijing2008lm?type=blog"><i class="fas fa-c"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Mail" href="mailto:0xforee@gmail.com"><i class="fas fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-08-17T18:23:34.000Z">2023-08-18</time></p><p class="title"><a href="/2023/08/18/lifecycle-i-of-glide-code-design/">从代码设计看 Glide 之生命周期（上）</a></p><p class="categories"><a href="/categories/Glide/">Glide</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-08-15T14:32:03.000Z">2023-08-15</time></p><p class="title"><a href="/2023/08/15/upgrade-my-site-config/">【公告】站点升级&amp;域名切换</a></p><p class="categories"><a href="/categories/Other/">Other</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-08-11T14:06:00.000Z">2023-08-11</time></p><p class="title"><a href="/2023/08/11/core_of_glide_code_design/">从代码设计看 Glide 之核心功能</a></p><p class="categories"><a href="/categories/Glide/">Glide</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-08-01T14:51:07.000Z">2023-08-01</time></p><p class="title"><a href="/2023/08/01/how-to-use-kotlin-coroutine/">一文帮你快速理解协程使用模型</a></p><p class="categories"><a href="/categories/kotlin/">kotlin</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-02T15:57:00.000Z">2023-07-02</time></p><p class="title"><a href="/2023/07/02/begging_of_glide_code_design/">从代码设计看 Glide 之写在开头</a></p><p class="categories"><a href="/categories/Glide/">Glide</a></p></div></article></div></div><div class="card widget is-sticky" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#写在前边"><span class="level-left"><span class="level-item">1</span><span class="level-item">写在前边</span></span></a></li><li><a class="level is-mobile" href="#正文"><span class="level-left"><span class="level-item">2</span><span class="level-item">正文</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Mapping-文件的来源与用途"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Mapping 文件的来源与用途</span></span></a></li><li><a class="level is-mobile" href="#了解-Mapping-文件的好处"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">了解 Mapping 文件的好处</span></span></a></li><li><a class="level is-mobile" href="#如何解析-Mapping-文件"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">如何解析 Mapping 文件</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#无内联优化："><span class="level-left"><span class="level-item">2.3.1</span><span class="level-item">无内联优化：</span></span></a></li><li><a class="level is-mobile" href="#有内联优化"><span class="level-left"><span class="level-item">2.3.2</span><span class="level-item">有内联优化</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Mapping-示例分析"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">Mapping 示例分析</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#简单示例"><span class="level-left"><span class="level-item">2.4.1</span><span class="level-item">简单示例</span></span></a></li><li><a class="level is-mobile" href="#复杂示例"><span class="level-left"><span class="level-item">2.4.2</span><span class="level-item">复杂示例</span></span></a></li><li><a class="level is-mobile" href="#方法内联"><span class="level-left"><span class="level-item">2.4.3</span><span class="level-item">方法内联</span></span></a></li></ul></li><li><a class="level is-mobile" href="#R8-编译器"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">R8 编译器</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#注释"><span class="level-left"><span class="level-item">2.5.1</span><span class="level-item">注释</span></span></a></li><li><a class="level is-mobile" href="#与-Proguard-区别"><span class="level-left"><span class="level-item">2.5.2</span><span class="level-item">与 Proguard 区别</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#后记"><span class="level-left"><span class="level-item">3</span><span class="level-item">后记</span></span></a></li></ul></div></div><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/bbb.png" alt="0xforee&#039;s blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 0xforee</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv"><span id="busuanzi_value_site_pv">0</span>次访问</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script type="module" src="https://cdn.jsdelivr.net/gh/emaction/frontend.dist@1.0.9/bundle.js"></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"栏目","tags":"标签"});
        });</script></body></html>